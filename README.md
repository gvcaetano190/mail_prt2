# Mail PRT2 - Plugin GLPI 11

Mail PRT2 GLPI Plugin aims at keeping track of email conversations.
It will combine emails from the same conversation into one Ticket.

**This version (1.0.0) is compatible with GLPI 11.0.x**

Based on the original Mail Analyzer plugin by Olivier Moron.

## Installation

1. Download the plugin from: https://github.com/gvcaetano190/mail_prt2/releases
2. Extract the zip file
3. Copy the `mail_prt2` folder into *glpifolder*/plugins/
4. Go to Setup > Plugins in GLPI
5. Install and Enable the plugin

## Description

It creates a new table in the DB with the purpose of storing email guid (generated by email servers) in order to be able (if possible) to match emails in mailgate which have been sent using 'CC' and 'Reply to all'.
It cannot keep track of forwarded emails and replies to them.

This solves the problem of duplicated Tickets when an email is sent to GLPI and CC (carbon copy) to others. And when those CC users use 'Reply to All', GLPI by default will create a new ticket. See: http://glpi.userecho.com/topic/1090667-new-rule-criteria-for-mail-receivers/

## GLPI 11 Compatibility

This version includes the following features to support GLPI 11:

### Database Queries
- Uses `$DB->doQuery()` for raw SQL queries
- Uses `$DB->request()` with array-based syntax with explicit `FROM` and `WHERE` keys

### Input Sanitization
- No `html_entity_decode()` calls as GLPI 11 no longer auto-sanitizes input
- Data is handled in its raw state as per GLPI 11 changes

### Output Escaping
- Uses `htmlescape()` function for proper XSS protection in HTML output
- Updated form rendering to properly escape dynamic content

### Script Includes
- No need to include `inc/includes.php` as GLPI 11 loads files automatically

### Class Names
- Main plugin class: `PluginMailPrt2Mailprt2`
- Config class: `PluginMailPrt2Config`
- Mail Collector class: `PluginMailPrt2MailCollector`

### Version Requirements
- Minimum GLPI version: 11.0.0
- Maximum GLPI version: 12.0

## Configuration

After installation, go to Setup > General > Mail PRT2 tab to configure the plugin options:

- **Use of Thread Index**: Enable/disable the use of Microsoft Thread-Index header for better email conversation tracking

## Issues and Support

Please report any questions or problems in the issue section:
https://github.com/gvcaetano190/mail_prt2/issues

## License

GPL v2+

## Author

Gabriel Caetano

Based on the original Mail Analyzer plugin by Olivier Moron.
