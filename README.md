# MailAnalyzer - GLPI 11 Compatible

Mail Analyzer GLPI Plugin aims at keeping track of email conversations.
It will combine emails from the same conversation into one Ticket.

**This version (4.0.0) is compatible with GLPI 11.0.x**

For GLPI 10.0.x, please use version 3.2.2 or earlier.

## Installation

Must be copied into *glpifolder*/plugins/mailanalyzer, or it can be downloaded from the GLPI plugin marketplace.

To be installed and enabled via the plugins configuration page in GLPI.

## Description

It creates a new table in the DB with the purpose of storing email guid (generated by email servers) in order to be able (if possible) to match emails in mailgate which have been sent using 'CC' and 'Reply to all'.
It cannot keeps track of forwarded emails and replies to them.

This solves the problem of duplicated Tickets when an email is sent to GLPI and CC (carbon copy) to others. And when those CC users use 'Reply to All', GLPI by default will create a new ticket. See: http://glpi.userecho.com/topic/1090667-new-rule-criteria-for-mail-receivers/

## Changes for GLPI 11 Compatibility

This version includes the following changes to support GLPI 11:

### Database Queries
- Replaced deprecated `$DB->query()` with `$DB->doQuery()` for raw SQL queries
- Updated `$DB->request()` calls to use the new array-based syntax with explicit `FROM` and `WHERE` keys
- Removed usage of deprecated `or die()` pattern

### Input Sanitization
- Removed `html_entity_decode()` calls on input data as GLPI 11 no longer auto-sanitizes input
- Data is now handled in its raw state as per GLPI 11 changes

### Output Escaping
- Added `htmlescape()` function for proper XSS protection in HTML output
- Updated form rendering to properly escape dynamic content

### Script Includes
- Removed `include("../../../inc/includes.php")` as it's no longer needed in GLPI 11
- GLPI now automatically loads the required files

### Class Names
- Renamed main plugin class to follow GLPI naming conventions: `PluginMailanalyzerMailanalyzer`

### Return Types
- Added explicit return type declarations on methods where appropriate

### Version Requirements
- Minimum GLPI version: 11.0.0
- Maximum GLPI version: 12.0

## Configuration

After installation, go to Setup > General > Mail Analyzer tab to configure the plugin options:

- **Use of Thread Index**: Enable/disable the use of Microsoft Thread-Index header for better email conversation tracking

## Issues and Support

Please report any questions or problems in the issue section:
https://github.com/tomolimo/mailanalyzer/issues

## License

GPL v2+

## Author

Olivier Moron
